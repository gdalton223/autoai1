function twb_run_notif_check(){jQuery.ajax({type:"POST",url:twb.ajax_url,data:{action:"twb_notif_check",twb_nonce:twb.nonce}}).success((function(e){var t=jQuery.parseJSON(e);""!=t.html&&(1==t.changeLogo&&jQuery(".twb_admin_bar_menu_header span").addClass("twb_counted"),jQuery("#wp-admin-bar-twb_adminbar_info").append(t.html),jQuery(".twb_admin_bar_menu_content .twb-score-container").removeClass("twb-hidden"),jQuery(".twb_admin_bar_menu_content .twb-score-container .twb-score-circle").each((function(){twb_draw_score_circle(this)})),clearInterval(twb_run_notif_check))})).error((function(){clearInterval(twb_run_notif_check)}))}function twb_disable_check(){twb_inprogress=!0,jQuery(".twb-notoptimized").hover((function(){jQuery(this).parent().find(".twb-score-disabled-container").removeClass("twb-hidden")}),(function(){jQuery(this).parent().find(".twb-score-disabled-container").addClass("twb-hidden")}))}function twb_check_score(e){var t=jQuery(e).data("post_id"),n=jQuery(e).parent().parent().parent();jQuery(".twb_admin_bar_menu.twb_frontend").addClass("twb_score_inprogress"),n.find(".twb-optimized").hasClass("twb-hidden")?n.find(".twb-optimizing").removeClass("twb-hidden"):(n.find(".twb-score-overlay").removeClass("twb-hidden"),n.find(".twb-score-overlay div").removeClass("twb-reload").addClass("twb-loader")),n.find(".twb-notoptimized").addClass("twb-hidden"),n.hasClass("twb_elementor_settings_content")&&jQuery(".twb_elementor_control_title").text(twb.checking).removeClass("twb_not_optimized").prepend("<span class='twb_inprogress'></span>"),twb_disable_check(),jQuery.ajax({url:twb.ajax_url,type:"POST",dataType:"json",data:{action:"twb_check_score",post_id:t,twb_nonce:twb.nonce},success:function(e){if(e.error)n.find(".twb-score-overlay").removeClass("twb-hidden"),n.find(".twb-score-overlay div").removeClass("twb-loader").addClass("twb-reload");else{n.find(".twb-score-overlay").addClass("twb-hidden");var t=n.find(".twb-score-desktop").find(".twb-score-circle");t.data({score:e.desktop_score,tti:e.desktop_tti}),twb_draw_score_circle(t);var r=n.find(".twb-score-mobile").find(".twb-score-circle");r.data({score:e.mobile_score,tti:e.mobile_tti}),twb_draw_score_circle(r)}},error:function(e,t,r){n.find(".twb-score-overlay").removeClass("twb-hidden"),n.find(".twb-score-overlay div").removeClass("twb-loader").addClass("twb-reload")},complete:function(e,t){n.find(".twb-optimizing").addClass("twb-hidden"),n.find(".twb-optimized").removeClass("twb-hidden"),jQuery("#wpadminbar .twb-optimized .twb-score-container").removeClass("twb-hidden"),jQuery("#wpadminbar .twb_admin_bar_menu").removeClass("twb_score_inprogress"),jQuery("#wpadminbar .twb_menu_logo").remove(),jQuery("#wpadminbar .twb_not_optimized_logo").removeClass("twb-hidden"),jQuery("#wpadminbar .twb_admin_bar_menu_header").addClass("twb_not_optimized"),twb_inprogress=!1,jQuery(".twb-notoptimized").hover((function(){jQuery(this).parent().find(".twb-score-disabled-container").addClass("twb-hidden")})),n.hasClass("twb_elementor_settings_content")&&jQuery(".twb_elementor_control_title").text(twb.notoptimized).remove("span.twb_inprogress").addClass("twb_not_optimized")}})}function twb_draw_score_circle(e){var t=parseInt(jQuery(e).data("score")),n=parseInt(jQuery(e).data("size")),r=parseInt(jQuery(e).data("thickness")),i=t<=49?"rgb(253, 60, 49)":t>=90?"rgb(12, 206, 107)":"rgb(255, 164, 0)";jQuery(e).parent().find(".twb-load-time").html(jQuery(e).data("tti")),jQuery(e).circleProgress({value:t/100,size:n,startAngle:-Math.PI/4*2,lineCap:"round",emptyFill:"rgba(255, 255, 255, 0)",thickness:r,fill:{color:i}}).on("circle-animation-progress",(function(n,r){var a='<span class="twb-score0"></span>';0!=t&&(a=Math.round(t*r)),jQuery(e).find(".twb-score-circle-animated").html(a).css({color:i}),jQuery(e).find("canvas").html(Math.round(t*r))}))}function twb_add_elementor_button(){window.elementor.modules.layouts.panel.pages.menu.Menu.addItem({name:twb.title,icon:"twb-element-menu-icon",title:twb.title,type:"page",callback:()=>{try{window.$e.route("panel/page-settings/twb_optimize")}catch(e){window.$e.route("panel/page-settings/settings"),window.$e.route("panel/page-settings/twb_optimize")}}},"more")}jQuery((function(){if(jQuery(".bwg-container").length){var e='<div class="twb_admin_bar_menu_header">';e+='<img class="twb_menu_logo" src="'+twb.plugin_url+'/assets/images/logo_white.svg" />',e+='<div class="twb_menu_logo">Optimize Images</div>',e+="</div>",jQuery(".twb_admin_bar_menu").html(e).on("click",(function(){window.open(twb.href,"_blank")})),jQuery(".twb_admin_bar_menu_main").remove()}twb_inprogress=!1,jQuery(".twb-notoptimized").each((function(){"inprogress"==jQuery(this).data("status")&&twb_disable_check()})),jQuery(".twb-notoptimized .twb_check_score_button").on("click",(function(){twb_inprogress||twb_check_score(this)})),jQuery("th[id^='twb-speed-']").hover((function(){jQuery(this).find(".twb-dismiss-container").removeClass("twb-hidden")}),(function(){jQuery(this).find(".twb-dismiss-container").addClass("twb-hidden")})),jQuery(".twb-see-score").hover((function(){jQuery(this).parent().parent().find(".twb-score-container").removeClass("twb-hidden")}),(function(){jQuery(this).parent().parent().find(".twb-score-container").addClass("twb-hidden")})),jQuery(".twb-score-container:not(.twb_admin_bar_menu_content .twb-score-container), .twb-score-disabled-container").hover((function(){jQuery(this).removeClass("twb-hidden")}),(function(){jQuery(this).addClass("twb-hidden")})),jQuery(".twb-score-circle").each((function(){twb_draw_score_circle(this)})),jQuery("#wp-admin-bar-twb_adminbar_info").mouseenter((function(){jQuery(".twb_admin_bar_menu_main .twb-score-container").removeClass("twb-hidden"),jQuery(".twb_admin_bar_menu_main").removeClass("twb-hidden")})).mouseleave((function(){jQuery(".twb_admin_bar_menu_main").addClass("twb-hidden")})),jQuery(".twb-score-circle").each((function(){twb_draw_score_circle(this)})),jQuery(".twb_admin_bar_menu.twb_backend span").hasClass("twb_backend_optimizing_logo")&&(twb_run_notif_check=setInterval(twb_run_notif_check,3e4))})),jQuery(window).on("elementor:init",(()=>{window.elementor.on("panel:init",(()=>{setTimeout(twb_add_elementor_button)}))}));